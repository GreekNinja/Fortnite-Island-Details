<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fortnite Map Details - Animated</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400..900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Custom Styles for a Futuristic/Tech Aesthetic */
        body {
            font-family: 'Rajdhani', sans-serif;
            /* More complex background with subtle animation */
            background: linear-gradient(135deg, #0a192f, #1a2a4a, #0a192f);
            background-size: 400% 400%;
            animation: gradientAnimation 15s ease infinite;
            color: #e2e8f0; /* Light gray text */
            min-height: 100vh;
            padding: 1rem;
            overflow-x: hidden; /* Prevent horizontal scroll */
        }

        @keyframes gradientAnimation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        h1, h2 {
            font-family: 'Orbitron', sans-serif;
            color: #00ffff; /* Cyan/Aqua for headings */
            text-shadow: 0 0 8px rgba(0, 255, 255, 0.6); /* Neon glow */
        }

        /* Card/Container Styling with tech-inspired borders */
        .tech-card {
            background-color: rgba(17, 25, 40, 0.8); /* Darker background with transparency */
            backdrop-filter: blur(10px); /* Stronger blur */
            border: 2px solid #00ffff; /* Cyan border */
            border-radius: 1rem;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3); /* Cyan glow shadow */
            position: relative;
            overflow: hidden;
            padding: 1.5rem;
            animation: fadeInScale 0.5s ease-out; /* Entrance animation */
        }

         @keyframes fadeInScale {
             0% { opacity: 0; transform: scale(0.95); }
             100% { opacity: 1; transform: scale(1); }
         }


        /* Animated border effect */
        .tech-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 2px solid transparent;
            border-image: linear-gradient(45deg, #00ffff, #ff00ff, #00ffff);
            border-image-slice: 1;
            z-index: 1;
            pointer-events: none;
            animation: borderPulse 4s infinite ease-in-out;
        }

         @keyframes borderPulse {
             0% { border-image-slice: 1; opacity: 0.8; }
             50% { border-image-slice: 2; opacity: 1; }
             100% { border-image-slice: 1; opacity: 0.8; }
         }


        /* Button Styling with energy effect */
        button, a.button {
            background: linear-gradient(45deg, #00ffff, #ff00ff); /* Gradient button */
            color: #1a1a2e; /* Dark text on bright button */
            font-family: 'Orbitron', sans-serif;
            font-weight: bold;
            padding: 0.75rem 2rem;
            border-radius: 0.5rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            z-index: 1;
            text-decoration: none; /* Remove underline from anchor buttons */
            display: inline-block; /* Ensure anchor buttons behave like buttons */
            text-align: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3); /* Button shadow */
        }

        button::before, a.button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 300%;
            height: 300%;
            background: rgba(255, 255, 255, 0.2);
            transition: all 0.6s ease;
            border-radius: 50%;
            transform: translate(-50%, -50%) scale(0);
            z-index: -1;
        }

        button:hover::before, a.button:hover::before {
            transform: translate(-50%, -50%) scale(1);
        }

        button:hover, a.button:hover {
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.6); /* Cyan glow on hover */
            transform: translateY(-3px); /* More pronounced lift */
            opacity: 1; /* Ensure full opacity on hover */
        }

        /* Input Field Styling */
        input[type="text"] {
            background-color: rgba(26, 42, 74, 0.9); /* Dark blue with transparency */
            color: #00ffff; /* Cyan text */
            border: 2px solid #ff00ff; /* Magenta border */
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        input[type="text"]:focus {
            border-color: #00ffff; /* Cyan on focus */
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.5); /* Cyan glow on focus */
            outline: none;
        }

        /* Image Container Hover Effect */
        .image-container {
             position: relative;
             overflow: hidden;
             border-radius: 0.75rem; /* Rounded corners for image container */
             box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
             transition: transform 0.3s ease, box-shadow 0.3s ease;
             /* Improved image size */
             width: 100%; /* Image fills container width */
             height: 350px; /* Slightly increased fixed height for consistency */
        }

        .image-container:hover {
            transform: scale(1.03); /* Slightly enlarge image container */
            box-shadow: 0 8px 20px rgba(0, 255, 255, 0.4); /* Cyan glow on hover */
        }

        /* Image Styling */
        #mapImage {
            width: 100%;
            height: 100%;
            object-fit: cover; /* Covers container without distortion */
            display: block;
            transition: transform 0.3s ease; /* Smooth scale on hover */
        }

         .image-container:hover #mapImage {
             transform: scale(1.1); /* Scale image inside container on hover */
         }

        /* Overlay text on image hover */
         .image-overlay {
            position: absolute;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 2; /* Ensure overlay is above image */
         }

         .image-container:hover .image-overlay {
             opacity: 1;
         }

        /* Tag Styling */
        .tag {
            background-color: #ff00ff; /* Magenta background */
            color: #1a1a2e; /* Dark text */
            padding: 0.2rem 0.6rem;
            border-radius: 9999px;
            font-size: 0.7rem;
            font-weight: bold;
            text-transform: uppercase;
        }

        /* List Item Styling (History/Favorites) */
        .list-item {
            background-color: rgba(26, 42, 74, 0.7); /* Darker blue with transparency */
            border: 1px solid #ff00ff; /* Magenta border */
            padding: 1rem;
            border-radius: 0.75rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 8px rgba(255, 0, 255, 0.2); /* Magenta glow shadow */
            transition: background-color 0.2s ease, transform 0.2s ease;
        }

        .list-item:hover {
            background-color: rgba(36, 52, 84, 0.8); /* Slightly lighter on hover */
            transform: translateX(5px); /* Slide slightly on hover */
        }

        .list-item button {
            background: none;
            border: none;
            padding: 0;
            margin: 0;
            font-size: 1rem;
            text-align: left;
            color: #00ffff; /* Cyan text */
            text-decoration: none;
            transition: color 0.2s ease;
             /* Reset general button styles */
            transform: none;
            box-shadow: none;
            opacity: 1;
        }

        .list-item button:hover {
            color: #ff00ff; /* Magenta on hover */
            text-decoration: underline;
        }

        .list-item .remove-btn {
            color: #ff4136; /* Red for remove */
            transition: color 0.2s ease;
        }

        .list-item .remove-btn:hover {
            color: #e74c3c; /* Darker red on hover */
        }

        /* Fullscreen Modal Styling */
        #fullscreenModal {
            background-color: rgba(0, 0, 0, 0.98); /* Very dark overlay */
        }

        #fullscreenImage {
            border: 3px solid #00ffff; /* Cyan border for fullscreen image */
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.8); /* Strong cyan glow */
        }

        .close-btn {
            background-color: rgba(26, 42, 74, 0.7); /* Dark blue transparent background */
            color: #ff00ff; /* Magenta 'X' */
            border: 2px solid #ff00ff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background-color: rgba(255, 0, 255, 0.8); /* Magenta on hover */
            color: #1a1a2e; /* Dark text on hover */
            transform: rotate(90deg); /* Rotate effect */
        }

        /* --- Custom Animations --- */

        /* Animation for titles */
        .animated-heading {
            animation: textGlow 2s infinite alternate;
        }

        @keyframes textGlow {
            0% { text-shadow: 0 0 8px rgba(0, 255, 255, 0.6); }
            100% { text-shadow: 0 0 15px rgba(0, 255, 255, 1); }
        }

        /* Animation for buttons (more intense) */
        button.animated-button, a.button.animated-button {
             animation: pulseButton 1.5s infinite ease-in-out;
        }

        @keyframes pulseButton {
            0% { transform: scale(1); box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3); }
            50% { transform: scale(1.05); box-shadow: 0 0 20px rgba(0, 255, 255, 0.8); }
            100% { transform: scale(1); box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3); }
        }

        /* Animation for list items on hover */
        .list-item:hover {
             animation: listItemPulse 0.5s ease-out;
        }

        @keyframes listItemPulse {
            0% { transform: scale(1) translateX(0); }
            50% { transform: scale(1.01) translateX(5px); }
            100% { transform: scale(1) translateX(0); }
        }

         /* Animation for image on hover (smoother) */
         .image-container:hover #mapImage {
             transform: scale(1.05); /* Slightly less scale */
         }

        /* Animation for Save as Favorite button click */
        @keyframes favoriteBurst {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.5); opacity: 0.5; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* Animation for Remove Favorite button click */
        @keyframes removeShrink {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(0.8); opacity: 0; }
        }

        /* Animation for spawning particles (hearts/stars) */
        @keyframes particleFadeOut {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(-50px) rotate(180deg); opacity: 0; }
        }

        .particle {
            position: absolute;
            font-size: 1.5rem;
            pointer-events: none;
            animation: particleFadeOut 1s ease-out forwards;
            color: #ff00ff; /* Magenta color for particles */
        }


    </style>
</head>
<body class="bg-gradient-to-br from-blue-900 via-purple-900 to-gray-900 text-white font-sans min-h-screen p-4">
    <div class="container mx-auto p-6 max-w-4xl">

        <div id="errorAlert" class="hidden bg-red-600 text-white p-4 rounded-lg shadow-lg mb-6 flex justify-between items-center tech-card !border-red-600 !shadow-red-600/50">
            <span id="errorText">Error: Something went wrong.</span>
            <button onclick="dismissError()" class="bg-gray-700 px-4 py-2 rounded-lg hover:bg-gray-600 transition duration-300 ease-in-out">Dismiss</button>
        </div>

        <div class="mb-8 text-center tech-card">
            <h1 class="text-4xl font-bold mb-4 animated-heading">Fortnite Creative Maps</h1>
            <p class="text-gray-400 mb-6">Enter a map code to get details.</p>
            <div class="flex flex-col md:flex-row justify-center items-center gap-4">
                <input id="mapCode" type="text" placeholder="Enter map code (e.g., 1234-5678-9123)" class="p-3 w-full md:w-1/2 rounded-lg focus:outline-none" style="color: #00ffff; background-color: rgba(26, 42, 74, 0.9); border: 2px solid #ff00ff;">
                <button onclick="fetchMapDetails()" class="button animated-button">Search</button>
            </div>
        </div>

        <div id="mapDetails" class="hidden bg-gray-800 rounded-lg shadow-lg flex flex-col md:flex-row overflow-hidden tech-card">
            <div class="w-full md:w-1/2 cursor-pointer image-container" id="mapImageContainer">
                 <img id="mapImage" src="" alt="Map Image" class="w-full h-full object-cover" onerror="this.onerror=null; this.src='https://placehold.co/1920x1080/4a5568/ffffff?text=No+Image+Available';">
                 <div class="image-overlay">
                    <span class="text-white text-xl font-bold">Click to View Fullscreen</span>
                 </div>
            </div>

            <div class="w-full md:w-1/2 p-6">
                <h1 id="mapTitle" class="text-3xl font-bold mb-2 animated-heading"></h1>
                <p class="text-gray-400 mb-4">By <span id="mapCreator" class="text-yellow-300 font-semibold"></span></p>
                <div id="mapTags" class="flex flex-wrap gap-2 mb-4"></div>

                <p id="mapIntroduction" class="mb-4 text-gray-300 italic border-l-4 border-yellow-500 pl-4"></p>
                <p id="mapDescription" class="mb-4 text-gray-300"></p>

                <div class="grid grid-cols-2 gap-4 text-sm text-gray-400 mb-6">
                    <div>
                        <p>Release Date:</p>
                        <p id="mapReleaseDate" class="text-white font-semibold"></p>
                    </div>
                    <div>
                        <p>XP Status:</p>
                        <p id="mapXPStatus" class="text-white font-semibold"></p>
                    </div>
                </div>

                <div class="flex flex-col sm:flex-row items-center gap-4">
                    <a id="playNowButton" href="#" target="_blank" class="button animated-button">
                        PLAY NOW
                    </a>
                    <p class="text-gray-400 text-sm">Map Code: <span id="mapCodeDisplay" class="text-white font-bold font-game"></span></p>
                </div>

                <button onclick="saveFavorite(event)" class="button mt-4 animated-button" style="background: linear-gradient(45deg, #ff00ff, #00ffff);">
                    ⭐ Save as Favorite
                </button>
            </div>
        </div>

        <div class="mt-8 tech-card">
            <h2 class="text-2xl font-bold mb-4 animated-heading">📜 Search History</h2>
            <ul id="searchHistory" class="space-y-4"></ul>
        </div>

        <div class="mt-8 tech-card">
            <h2 class="text-2xl font-bold mb-4 animated-heading">⭐ Favorite Maps</h2>
            <ul id="favoriteMaps" class="space-y-4"></ul>
        </div>

        <div id="fullscreenModal" class="hidden fixed top-0 left-0 w-full h-full modal-overlay flex justify-center items-center z-50 p-4">
            <img id="fullscreenImage" src="" class="max-w-full max-h-full object-contain rounded-lg shadow-lg">
            <button onclick="closeFullscreen()" class="absolute top-6 right-6 close-btn">X</button>
        </div>
    </div>

    <script>
        // IMPORTANT: Replace with your actual API key from FortniteAPI.io
        const API_KEY = "eadee0b6-665fb82d-1a863033-2f764868";

        // Load history and favorites from local storage
        const searchHistory = JSON.parse(localStorage.getItem("searchHistory")) || [];
        const favoriteMaps = JSON.parse(localStorage.getItem("favoriteMaps")) || [];

        // Render history and favorites on page load
        document.addEventListener("DOMContentLoaded", () => {
            renderSearchHistory();
            renderFavorites();
        });

        /**
         * Fetches map details from the Fortnite API based on the provided code.
         * @param {string|null} code - The map code to fetch. If null, it uses the value from the input field.
         */
        async function fetchMapDetails(code = null) {
            const mapCode = code || document.getElementById("mapCode").value.trim(); // Trim whitespace
            if (!mapCode) {
                showError("Please enter a valid map code!");
                return;
            }

            // Clear previous details and hide the section while loading
            document.getElementById("mapDetails").classList.add("hidden");
            // Optionally show a loading indicator here

            try {
                const response = await fetch(`https://fortniteapi.io/v1/creative/island?code=${mapCode}`, {
                    headers: { "Authorization": API_KEY }
                });
                const data = await response.json();

                // Check if the API call was successful and returned a result
                if (!data.result || !data.island) {
                     // Check for specific error messages from the API if available
                    const errorMessage = data.error || "Map not found. Please try another code!";
                    showError(errorMessage);
                    return;
                }

                const island = data.island;

                // Populate map details
                document.getElementById("mapTitle").innerText = island.title;
                document.getElementById("mapCreator").innerText = island.creator;
                document.getElementById("mapIntroduction").innerText = island.introduction || "No introduction available.";
                document.getElementById("mapDescription").innerText = island.description || "No description available.";
                document.getElementById("mapReleaseDate").innerText = island.publishedDate ? new Date(island.publishedDate).toLocaleDateString() : 'N/A';
                document.getElementById("mapXPStatus").innerText = island.xp?.enabled ? "Awarding XP" : "No XP Available";
                document.getElementById("mapCodeDisplay").innerText = island.code;
                document.getElementById("playNowButton").href = `https://www.fortnite.com/play/island/${island.code}`;

                // Set map image, use placeholder if image is missing or fails to load
                const mapImageElement = document.getElementById("mapImage");
                mapImageElement.src = island.image || "https://placehold.co/1920x1080/4a5568/ffffff?text=No+Image+Available";
                // The onerror attribute in the HTML handles the fallback if the provided URL fails

                // Add tags
                const tagsContainer = document.getElementById("mapTags");
                tagsContainer.innerHTML = ""; // Clear old tags
                if (island.tags && island.tags.length > 0) {
                    island.tags.forEach(tag => {
                        const tagElement = document.createElement("span");
                        tagElement.className = "tag"; // Use the new tag class
                        tagElement.innerText = tag;
                        tagsContainer.appendChild(tagElement);
                    });
                } else {
                     tagsContainer.innerHTML = '<span class="text-gray-400 text-sm">No tags available.</span>';
                }


                saveSearchHistory({ code: island.code, title: island.title, tags: island.tags });
                document.getElementById("mapDetails").classList.remove("hidden");
                // Scroll to map details section
                document.getElementById("mapDetails").scrollIntoView({ behavior: 'smooth' });

            } catch (error) {
                console.error("Error fetching map details:", error);
                showError("An error occurred while fetching map details. Please check the code and your API key.");
            }
        }

        /**
         * Saves the searched map to local storage history.
         * Keeps the history limited to the last 5 unique searches.
         * @param {object} map - The map object to save ({ code, title, tags }).
         */
        function saveSearchHistory(map) {
             // Remove existing entry with the same code to avoid duplicates and move to top
            const existingIndex = searchHistory.findIndex(m => m.code === map.code);
            if (existingIndex !== -1) {
                searchHistory.splice(existingIndex, 1);
            }

            searchHistory.unshift(map); // Add to the beginning
            if (searchHistory.length > 5) { // Keep only the last 5
                searchHistory.pop();
            }
            localStorage.setItem("searchHistory", JSON.stringify(searchHistory));
            renderSearchHistory();
        }

        /**
         * Saves the currently displayed map as a favorite in local storage and triggers particle animation.
         * @param {Event} event - The click event.
         */
        function saveFavorite(event) {
            const mapCode = document.getElementById("mapCodeDisplay").innerText;
            const mapTitle = document.getElementById("mapTitle").innerText;
            const tags = Array.from(document.getElementById("mapTags").children).map(tag => tag.innerText).filter(text => text !== 'No tags available.'); // Get tags, exclude placeholder text

            if (!mapCode || !mapTitle) {
                showError("No map details to save as favorite!");
                return;
            }

            if (!favoriteMaps.find(m => m.code === mapCode)) {
                favoriteMaps.push({ code: mapCode, title: mapTitle, tags });
                localStorage.setItem("favoriteMaps", JSON.stringify(favoriteMaps));
                renderFavorites();
                // Trigger particle animation
                createParticles(event.clientX, event.clientY, '⭐'); // Use star or heart emoji
                // Optional: Show a success message
                // showError("Map saved to favorites!", false);
            } else {
                 // Optional: Indicate it's already a favorite
                 // showError("This map is already in your favorites!", false);
            }
        }

        /**
         * Removes a map from the favorite list by its code and triggers animation.
         * @param {string} code - The map code to remove.
         * @param {Event} event - The click event.
         */
        function removeFavorite(code, event) {
            const index = favoriteMaps.findIndex(m => m.code === code);
            if (index !== -1) {
                // Optional: Add a shrink animation to the list item before removing
                const listItem = event.target.closest('.list-item');
                if (listItem) {
                    listItem.style.animation = 'removeShrink 0.5s ease-out forwards';
                    listItem.addEventListener('animationend', () => {
                         favoriteMaps.splice(index, 1);
                         localStorage.setItem("favoriteMaps", JSON.stringify(favoriteMaps));
                         renderFavorites();
                    }, { once: true });
                } else {
                    // Fallback if animation doesn't apply
                    favoriteMaps.splice(index, 1);
                    localStorage.setItem("favoriteMaps", JSON.stringify(favoriteMaps));
                    renderFavorites();
                }
            }
        }

        /**
         * Renders the search history list in the UI.
         */
        function renderSearchHistory() {
            const historyContainer = document.getElementById("searchHistory");
            if (searchHistory.length === 0) {
                historyContainer.innerHTML = '<li class="text-gray-400 list-item">No search history yet.</li>';
                return;
            }
            historyContainer.innerHTML = searchHistory.map(map => `
                <li class="list-item">
                    <div>
                        <button onclick="fetchMapDetails('${map.code}')" class="text-yellow-300 hover:underline font-semibold">${map.title}</button>
                        <p class="text-gray-400 text-sm">${map.code}</p>
                        <div class="flex flex-wrap gap-1 mt-1">
                            ${map.tags?.map(tag => `<span class="tag">${tag}</span>`).join("") || ""}
                        </div>
                    </div>
                </li>
            `).join("");
        }

        /**
         * Renders the favorite maps list in the UI.
         */
        function renderFavorites() {
            const favoritesContainer = document.getElementById("favoriteMaps");
             if (favoriteMaps.length === 0) {
                favoritesContainer.innerHTML = '<li class="text-gray-400 list-item">No favorite maps saved yet.</li>';
                return;
            }
            favoritesContainer.innerHTML = favoriteMaps.map(map => `
                <li class="list-item">
                    <div>
                        <button onclick="fetchMapDetails('${map.code}')" class="text-yellow-300 hover:underline font-semibold">${map.title}</button>
                         <p class="text-gray-400 text-sm">${map.code}</p>
                        <div class="flex flex-wrap gap-1 mt-1">
                            ${map.tags?.map(tag => `<span class="tag">${tag}</span>`).join("") || ""}
                        </div>
                    </div>
                    <button onclick="removeFavorite('${map.code}', event)" class="text-red-400 hover:text-red-500 text-sm ml-4 remove-btn">Remove</button>
                </li>
            `).join("");
        }

        /**
         * Displays a custom error message.
         * @param {string} message - The error message to display.
         * @param {boolean} isError - True if it's an error, false for success/info (optional, defaults to true).
         */
        function showError(message, isError = true) {
            const errorAlert = document.getElementById("errorAlert");
            const errorText = document.getElementById("errorText");

            errorText.innerText = message;
            if (isError) {
                 errorAlert.classList.remove("bg-green-600"); // Remove potential success color
                 errorAlert.classList.add("bg-red-600"); // Add error color
                 errorAlert.classList.add("!border-red-600", "!shadow-red-600/50"); // Add error specific tech-card styles
                 errorAlert.classList.remove("!border-green-600", "!shadow-green-600/50"); // Remove success specific tech-card styles
            } else {
                 errorAlert.classList.remove("bg-red-600"); // Remove potential error color
                 errorAlert.classList.add("bg-green-600"); // Add success color
                 errorAlert.classList.add("!border-green-600", "!shadow-green-600/50"); // Add success specific tech-card styles
                 errorAlert.classList.remove("!border-red-600", "!shadow-red-600/50"); // Remove error specific tech-card styles
            }
            errorAlert.classList.remove("hidden");
        }

        /**
         * Dismisses the custom error/message alert.
         */
        function dismissError() {
            document.getElementById("errorAlert").classList.add("hidden");
        }

        /**
         * Opens the fullscreen modal with the current map image.
         */
        function openFullscreen() {
             const mapImageSrc = document.getElementById("mapImage").src;
             if (!mapImageSrc || mapImageSrc.includes('placehold.co') || mapImageSrc.includes('No+Image+Available')) {
                 // Don't open fullscreen if no valid image is loaded (check for placeholder text too)
                 return;
             }
            const fullscreenModal = document.getElementById("fullscreenModal");
            const fullscreenImage = document.getElementById("fullscreenImage");

            fullscreenImage.src = mapImageSrc;
            fullscreenModal.classList.remove("hidden");
        }

        /**
         * Closes the fullscreen modal.
         */
        function closeFullscreen() {
            document.getElementById("fullscreenModal").classList.add("hidden");
        }

        /**
         * Creates and animates particles (emojis) at a given position.
         * @param {number} x - The x-coordinate.
         * @param {number} y - The y-coordinate.
         * @param {string} emoji - The emoji character to use as a particle.
         */
        function createParticles(x, y, emoji) {
            const numParticles = 15; // Number of particles
            for (let i = 0; i < numParticles; i++) {
                const particle = document.createElement('span');
                particle.className = 'particle';
                particle.innerText = emoji;
                // Position particles randomly around the click point
                const offsetX = (Math.random() - 0.5) * 60; // Random horizontal offset
                const offsetY = (Math.random() - 0.5) * 60; // Random vertical offset
                particle.style.left = `${x + offsetX}px`;
                particle.style.top = `${y + offsetY}px`;
                // Random delay for staggered effect
                particle.style.animationDelay = `${Math.random() * 0.3}s`;
                 // Randomize particle color slightly
                const hue = Math.random() * 360;
                particle.style.filter = `hue-rotate(${hue}deg)`;

                document.body.appendChild(particle);

                // Remove particle after animation ends
                particle.addEventListener('animationend', () => {
                    particle.remove();
                });
            }
        }


        // Add event listener to the map image container to open fullscreen on click
        document.getElementById("mapImageContainer").addEventListener("click", openFullscreen);

        // Add event listener to the input field for 'Enter' key press
        document.getElementById("mapCode").addEventListener("keypress", function(event) {
            if (event.key === "Enter") {
                event.preventDefault(); // Prevent default form submission
                fetchMapDetails(); // Trigger search
            }
        });

    </script>
</body>
</html>
